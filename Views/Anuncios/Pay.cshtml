@model PagoViewModel

@{
    ViewData["Title"] = "Pagar";
}

<div class="text-center mb-4">
    <h2>Pagar Anuncio</h2>
</div>

@if (User.Identity is not null && User.Identity.IsAuthenticated)
{
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 bg-light p-4 rounded">
                <form method="post" asp-action="CreatePayment" asp-controller="MercadoPago" onsubmit="return confirmPayment();">
                    <input type="hidden" asp-for="AnuncioId" />
                    <div class="mb-3">
                        <label asp-for="Amount" class="form-label"></label>
                        <input asp-for="Amount" class="form-control" readonly="readonly" value="@ViewBag.Total" />
                        <span asp-validation-for="Amount" class="text-danger"></span>
                    </div>
                    <div class="mb-3">
                        <label asp-for="Description" class="form-label"></label>
                        <input asp-for="Description" class="form-control" readonly="readonly" value="@ViewBag.Texto" />
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="mb-3 d-flex"> <!-- Contenedor flexible para el número de tarjeta -->
                        <div class="flex-fill me-2"> <!-- Flex para CardNumber -->
                            <label asp-for="CardNumber" class="form-label"></label>
                            <input asp-for="CardNumber" class="form-control" oninput="maskCardNumber(this);" maxlength="19" required style="width: 50%;"/> <!-- Estilo ajustado -->
                            <span asp-validation-for="CardNumber" class="text-danger"></span>
                        </div>
                        <div class="flex-fill me-2"> <!-- Flex para ExpirationMonth -->
                            <label asp-for="ExpirationMonth" class="form-label"></label>
                            <input asp-for="ExpirationMonth" class="form-control" oninput="maskExpirationMonth(this);" maxlength="2" style="width: 50px;" required />
                            <span asp-validation-for="ExpirationMonth" class="text-danger"></span>
                        </div>
                        <div class="flex-fill"> <!-- Flex para ExpirationYear -->
                            <label asp-for="ExpirationYear" class="form-label"></label>
                            <input asp-for="ExpirationYear" class="form-control" oninput="maskExpirationYear(this);" maxlength="2" style="width: 50px;" required />
                            <span asp-validation-for="ExpirationYear" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label asp-for="CardholderName" class="form-label"></label>
                        <input asp-for="CardholderName" class="form-control" maxlength="50" required />
                        <span asp-validation-for="CardholderName" class="text-danger"></span>
                    </div>
                    <div class="mb-3">
                        <label asp-for="SecurityCode" class="form-label"></label>
                        <input asp-for="SecurityCode" class="form-control" oninput="maskSecurityCode(this);" maxlength="3" style="width: 50px;" required />
                        <span asp-validation-for="SecurityCode" class="text-danger"></span>
                    </div>
                    <div class="mb-3">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control" maxlength="100" required />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <button type="submit" class="btn btn-primary">Pagar</button>
                </form>

                <h3 class="text-center mt-3">Sus datos de tarjeta se procesarán de forma segura y no serán almacenados en nuestros servidores.</h3>
            </div>
        </div>
    </div>

<script>
    function confirmPayment() {
        return confirm("¿Estás seguro de que deseas proceder con el pago?");
    }

    function maskCardNumber(input) {
        // Quitar todos los caracteres que no sean dígitos
        let value = input.value.replace(/\D/g, '');
        // Añadir guiones cada 4 dígitos
        let formattedValue = '';
        for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
                formattedValue += '-';
            }
            formattedValue += value[i];
        }
        input.value = formattedValue.slice(0, 19); // Limitar a 19 caracteres
    }

    function maskExpirationMonth(input) {
        // Quitar todos los caracteres que no sean dígitos
        let value = input.value.replace(/\D/g, '');
        // Limitar a 2 caracteres
        input.value = value.slice(0, 2);
    }

    function maskExpirationYear(input) {
        // Quitar todos los caracteres que no sean dígitos
        let value = input.value.replace(/\D/g, '');
        // Limitar a 2 caracteres
        input.value = value.slice(0, 2);
    }

    function maskSecurityCode(input) {
        // Quitar todos los caracteres que no sean dígitos
        let value = input.value.replace(/\D/g, '');
        // Limitar a 3 caracteres
        input.value = value.slice(0, 3);
    }
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}

}
else
{
    <div class="text-center">
        <h3>¡Inicia sesión para crear y visualizar anuncios!</h3>
    </div>
}




